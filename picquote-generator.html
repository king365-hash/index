<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å›¾ç‰‡å­—å¹•ç”Ÿæˆå™¨ - ä¸ºå›¾ç‰‡æ·»åŠ ç²¾ç¾å­—å¹•">
    <title>å›¾ç‰‡å­—å¹•ç”Ÿæˆå™¨ | PicQuote Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --primary-blue: #4A6FFF;
            --accent-purple: #7B2CBF;
            --neon-green: #00FF88;
            --text-white: #ffffff;
            --text-gray: #b0b0b0;
            --border-color: #333333;
            --shadow-glow: 0 0 20px rgba(74, 111, 255, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Microsoft YaHei', sans-serif;
            background: var(--bg-dark);
            color: var(--text-white);
            min-height: 100vh;
            line-height: 1.6;
            padding: 0;
        }

        /* Back Navigation */
        .back-nav {
            background: var(--bg-card);
            padding: 1rem 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border-color);
        }

        .back-nav a {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-white);
            text-decoration: none;
            font-size: 1rem;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            margin-left: 2rem;
        }

        .back-nav a:hover {
            background: var(--primary-blue);
            transform: translateX(-5px);
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 60px);
        }

        /* Control Panel */
        .control-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card);
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .control-panel h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Sections */
        section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        section h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--text-gray);
            font-weight: 600;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 2rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(74, 111, 255, 0.05);
        }

        .upload-area:hover {
            border-color: var(--primary-blue);
            background: rgba(74, 111, 255, 0.1);
        }

        .upload-area.dragover {
            border-color: var(--neon-green);
            background: rgba(0, 255, 136, 0.1);
        }

        .upload-area p {
            margin-bottom: 0.5rem;
            color: var(--text-gray);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .file-status {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        #imageInput {
            display: none;
        }

        /* Setting Items */
        .setting-item {
            margin-bottom: 1.2rem;
        }

        .setting-item:last-child {
            margin-bottom: 0;
        }

        .setting-item label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        .setting-item input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }

        .setting-item input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(74, 111, 255, 0.5);
        }

        .setting-item input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
            border: none;
        }

        .range-value {
            display: inline-block;
            margin-left: 0.5rem;
            color: var(--primary-blue);
            font-weight: 600;
            min-width: 40px;
        }

        .setting-item input[type="color"] {
            width: 100%;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            background: var(--bg-dark);
        }

        .setting-item select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-dark);
            color: var(--text-white);
            font-size: 0.95rem;
            cursor: pointer;
            outline: none;
        }

        .setting-item select:focus {
            border-color: var(--primary-blue);
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .setting-row input[type="range"] {
            flex: 1;
        }

        /* Textarea */
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-dark);
            color: var(--text-white);
            font-size: 0.95rem;
            font-family: inherit;
            resize: vertical;
            outline: none;
            transition: border-color 0.3s ease;
        }

        textarea:focus {
            border-color: var(--primary-blue);
        }

        .char-count {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-gray);
            margin-top: 0.5rem;
        }

        .char-count span {
            color: var(--primary-blue);
            font-weight: 600;
        }

        /* Download Button */
        .download-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-purple) 100%);
            border: none;
            border-radius: 8px;
            color: var(--text-white);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-glow);
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(74, 111, 255, 0.5);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        .download-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Preview Panel */
        .preview-panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-card);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 500px;
            position: relative;
        }

        .preview-panel h2 {
            position: absolute;
            top: 2rem;
            left: 2rem;
            font-size: 1.5rem;
            color: var(--primary-blue);
        }

        #previewCanvas {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .preview-hint {
            color: var(--text-gray);
            font-size: 1.1rem;
            text-align: center;
        }

        .preview-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: var(--text-gray);
        }

        .preview-placeholder-icon {
            font-size: 4rem;
            opacity: 0.3;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .control-panel {
                position: static;
            }

            .preview-panel h2 {
                position: static;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .back-nav a {
                margin-left: 1rem;
                font-size: 0.9rem;
            }

            .control-panel {
                padding: 1rem;
            }
        }

        /* Loading Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="back-nav">
        <a href="index.html">â† è¿”å›å·¥å…·é›†åˆ</a>
    </div>

    <div class="container">
        <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <h2>ğŸ“¸ å›¾ç‰‡å­—å¹•ç”Ÿæˆå™¨</h2>

            <!-- å›¾ç‰‡ä¸Šä¼  -->
            <section class="upload-section">
                <h3>ä¸Šä¼ å›¾ç‰‡</h3>
                <input type="file" id="imageInput" accept="image/*">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <p>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½å›¾ç‰‡</p>
                    <p class="file-status" id="fileStatus">æœªé€‰æ‹©æ–‡ä»¶</p>
                </div>
            </section>

            <!-- å­—å¹•è®¾ç½® -->
            <section class="settings-section">
                <h3>å­—å¹•è®¾ç½®</h3>

                <div class="setting-item">
                    <label>å­—å¹•é«˜åº¦ä½ç½®</label>
                    <div class="setting-row">
                        <input type="range" id="captionHeight" min="0" max="100" value="80">
                        <span class="range-value" id="captionHeightValue">80%</span>
                    </div>
                </div>

                <div class="setting-item">
                    <label>å­—ä½“å¤§å°</label>
                    <div class="setting-row">
                        <input type="range" id="fontSize" min="12" max="100" value="32">
                        <span class="range-value" id="fontSizeValue">32px</span>
                    </div>
                </div>

                <div class="setting-item">
                    <label>å­—ä½“é¢œè‰²</label>
                    <input type="color" id="fontColor" value="#FFFFFF">
                </div>

                <div class="setting-item">
                    <label>è½®å»“é¢œè‰²</label>
                    <input type="color" id="strokeColor" value="#000000">
                </div>

                <div class="setting-item">
                    <label>å­—ä½“æ ·å¼</label>
                    <select id="fontFamily">
                        <option value="Microsoft YaHei">å¾®è½¯é›…é»‘</option>
                        <option value="SimHei">é»‘ä½“</option>
                        <option value="Arial">Arial</option>
                        <option value="SimSun">å®‹ä½“</option>
                        <option value="KaiTi">æ¥·ä½“</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>å­—ä½“ç²—ç»†</label>
                    <select id="fontWeight">
                        <option value="400">æ­£å¸¸</option>
                        <option value="500">ä¸­ç­‰</option>
                        <option value="700" selected>ç²—ä½“</option>
                        <option value="900">ç‰¹ç²—</option>
                    </select>
                </div>

                <div class="setting-item">
                    <label>æ–‡å­—æè¾¹å®½åº¦</label>
                    <div class="setting-row">
                        <input type="range" id="strokeWidth" min="0" max="10" value="3">
                        <span class="range-value" id="strokeWidthValue">3px</span>
                    </div>
                </div>
            </section>

            <!-- å­—å¹•å†…å®¹ -->
            <section class="content-section">
                <h3>å­—å¹•å†…å®¹</h3>
                <textarea id="captionText" placeholder="åœ¨æ­¤è¾“å…¥å­—å¹•å†…å®¹...&#10;æ”¯æŒå¤šè¡Œæ–‡æœ¬"></textarea>
                <p class="char-count"><span id="charCount">0</span> å­—</p>
            </section>

            <!-- å¯¼å‡ºæŒ‰é’® -->
            <button id="downloadBtn" class="download-btn" disabled>â¬‡ï¸ ä¸‹è½½å›¾ç‰‡</button>
        </div>

        <!-- å³ä¾§é¢„è§ˆåŒºåŸŸ -->
        <div class="preview-panel">
            <div id="previewPlaceholder" class="preview-placeholder">
                <div class="preview-placeholder-icon">ğŸ–¼ï¸</div>
                <p>ä¸Šä¼ å›¾ç‰‡ååœ¨æ­¤é¢„è§ˆ</p>
            </div>
            <canvas id="previewCanvas" style="display: none;"></canvas>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentImage = null;
        let originalImageWidth = 0;
        let originalImageHeight = 0;

        // DOM å…ƒç´ 
        const imageInput = document.getElementById('imageInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileStatus = document.getElementById('fileStatus');
        const previewCanvas = document.getElementById('previewCanvas');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const downloadBtn = document.getElementById('downloadBtn');
        const captionText = document.getElementById('captionText');
        const charCount = document.getElementById('charCount');

        // è®¾ç½®é¡¹
        const captionHeight = document.getElementById('captionHeight');
        const captionHeightValue = document.getElementById('captionHeightValue');
        const fontSize = document.getElementById('fontSize');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const fontColor = document.getElementById('fontColor');
        const strokeColor = document.getElementById('strokeColor');
        const fontFamily = document.getElementById('fontFamily');
        const fontWeight = document.getElementById('fontWeight');
        const strokeWidth = document.getElementById('strokeWidth');
        const strokeWidthValue = document.getElementById('strokeWidthValue');

        // ä¸Šä¼ åŒºåŸŸç‚¹å‡»
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        // æ–‡ä»¶é€‰æ‹©
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleImageUpload(file);
            }
        });

        // æ‹–æ‹½ä¸Šä¼ 
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleImageUpload(file);
            }
        });

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function handleImageUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    currentImage = img;
                    originalImageWidth = img.width;
                    originalImageHeight = img.height;

                    // è®¾ç½® canvas å°ºå¯¸ä¸ºå›¾ç‰‡åŸå§‹å°ºå¯¸
                    previewCanvas.width = originalImageWidth;
                    previewCanvas.height = originalImageHeight;

                    // æ›´æ–°æ–‡ä»¶çŠ¶æ€
                    fileStatus.textContent = `å·²é€‰æ‹©: ${file.name}`;
                    fileStatus.style.color = 'var(--neon-green)';

                    // æ˜¾ç¤º canvasï¼Œéšè—å ä½ç¬¦
                    previewCanvas.style.display = 'block';
                    previewPlaceholder.style.display = 'none';

                    // å¯ç”¨ä¸‹è½½æŒ‰é’®
                    downloadBtn.disabled = false;

                    // æ¸²æŸ“é¢„è§ˆ
                    renderCanvas();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // æ¸²æŸ“ Canvas
        function renderCanvas() {
            if (!currentImage) return;

            const ctx = previewCanvas.getContext('2d');

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);

            // ç»˜åˆ¶å›¾ç‰‡
            ctx.drawImage(currentImage, 0, 0, previewCanvas.width, previewCanvas.height);

            // ç»˜åˆ¶å­—å¹•
            const text = captionText.value.trim();
            if (text) {
                const fontSizeValue = parseInt(fontSize.value);
                const captionHeightValue = parseInt(captionHeight.value);
                const strokeWidthNum = parseInt(strokeWidth.value);

                // è®¡ç®—å­—å¹•ä½ç½®ï¼ˆä»åº•éƒ¨å¼€å§‹çš„ç™¾åˆ†æ¯”ï¼‰
                const yPos = previewCanvas.height - (previewCanvas.height * captionHeightValue / 100);

                // è®¾ç½®å­—ä½“
                ctx.font = `${fontWeight.value} ${fontSizeValue}px ${fontFamily.value}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';

                // å¤„ç†å¤šè¡Œæ–‡æœ¬
                const lines = text.split('\n');
                const lineHeight = fontSizeValue * 1.3;
                const totalHeight = lines.length * lineHeight;
                let currentY = yPos - totalHeight + lineHeight;

                // ç»˜åˆ¶æ¯ä¸€è¡Œ
                lines.forEach((line) => {
                    const x = previewCanvas.width / 2;

                    // æ–‡å­—æè¾¹
                    if (strokeWidthNum > 0) {
                        ctx.strokeStyle = strokeColor.value;
                        ctx.lineWidth = strokeWidthNum;
                        ctx.lineJoin = 'round';
                        ctx.strokeText(line, x, currentY);
                    }

                    // æ–‡å­—å¡«å……
                    ctx.fillStyle = fontColor.value;
                    ctx.fillText(line, x, currentY);

                    currentY += lineHeight;
                });
            }
        }

        // å®æ—¶æ›´æ–°æ»‘å—å€¼æ˜¾ç¤º
        captionHeight.addEventListener('input', () => {
            captionHeightValue.textContent = captionHeight.value + '%';
            renderCanvas();
        });

        fontSize.addEventListener('input', () => {
            fontSizeValue.textContent = fontSize.value + 'px';
            renderCanvas();
        });

        strokeWidth.addEventListener('input', () => {
            strokeWidthValue.textContent = strokeWidth.value + 'px';
            renderCanvas();
        });

        // ç›‘å¬æ‰€æœ‰è®¾ç½®å˜åŒ–
        fontColor.addEventListener('input', renderCanvas);
        strokeColor.addEventListener('input', renderCanvas);
        fontFamily.addEventListener('change', renderCanvas);
        fontWeight.addEventListener('change', renderCanvas);

        // å­—å¹•å†…å®¹è¾“å…¥
        captionText.addEventListener('input', () => {
            const text = captionText.value;
            charCount.textContent = text.length;
            renderCanvas();
        });

        // ä¸‹è½½å›¾ç‰‡
        downloadBtn.addEventListener('click', () => {
            if (!currentImage) return;

            const link = document.createElement('a');
            link.download = 'picquote-' + Date.now() + '.png';
            link.href = previewCanvas.toDataURL('image/png');
            link.click();
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S ä¸‹è½½
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (!downloadBtn.disabled) {
                    downloadBtn.click();
                }
            }
        });
    </script>
</body>
</html>
